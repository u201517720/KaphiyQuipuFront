<form class="needs-validation" [formGroup]="frmContratoCompraVenta" novalidate>
    <div class="form-row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="card mt-0">
                <h5 class="card-header bg-primary text-white text-center align-middle p-0 pt-1 pb-1">
                    {{frmTitle}}{{frmContratoCompraVenta.value.correlativo}}
                </h5>
                <div class="card-body">
                    <div class="form-row"
                        *ngIf="userSession.RolId >= 7 && userSession.RolId <= 9 || locCodigoEstadoInt >= 10">
                        <div class="col-lg-8 col-md-9 col-sm-9 col-xs-9">
                            <div class="form-group row">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="destino" class="col-lg-4 col-form-label pr-0">FECHA REGISTRO</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <label class="col-form-label">{{locFechaRegistroString}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row"
                        *ngIf="userSession.RolId >= 7 && userSession.RolId <= 9 || locCodigoEstadoInt >= 10">
                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                            <div class="form-group row">
                                <label for="destino" class="col-lg-2 col-form-label pr-0">DISTRIBUIDORA</label>
                                <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10">
                                    <label class="col-form-label">{{frmContratoCompraVenta.value.distribuidora}}</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="destino" class="col-lg-4 col-form-label pr-0">ESTADO</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <label class="col-form-label">{{frmContratoCompraVenta.value.estado}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row bg-primary align-middle mb-2 pt-1 pb-1">
                        <label class="text-white ml-1">DATOS GENERALES</label>
                    </div>
                    <div class="form-row">
                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                            <div class="form-group row">
                                <label for="destino" class="col-lg-2 col-form-label pr-0">DESTINO</label>
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                    <ng-select [items]="listPaises" formControlName="pais" class="form-control"
                                        bindLabel="Descripcion" bindValue="Codigo" placeholder="País"
                                        [ngClass]="{ 'is-invalid': f.pais.invalid, 'is-valid': !f.pais.invalid }"
                                        [(ngModel)]="selectedPais" (change)="onChangePais($event)" [readonly]="true">
                                    </ng-select>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                    <ng-select [items]="listCiudades" formControlName="ciudad" class="form-control"
                                        bindLabel="Descripcion" bindValue="Codigo" placeholder="Ciudad"
                                        [ngClass]="{ 'is-invalid': f.ciudad.invalid, 'is-valid': !f.ciudad.invalid }"
                                        [(ngModel)]="selectedCiudad" [readonly]="true">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="moneda" class="col-lg-4 col-form-label">MONEDA</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <ng-select [items]="listMonedas" formControlName="moneda" class="form-control"
                                        bindLabel="Label" bindValue="Codigo" placeholder="Moneda"
                                        [ngClass]="{ 'is-invalid': f.moneda.invalid, 'is-valid': !f.moneda.invalid }"
                                        [(ngModel)]="selectedMoneda" (change)="ChangeMoneda()" [readonly]="true">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="unidadMedida" class="col-lg-5 col-form-label pr-0">UND.
                                    MEDIDA</label>
                                <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                    <ng-select [items]="listUniMedida" formControlName="unidadMedida"
                                        class="form-control" bindLabel="Label" bindValue="Codigo"
                                        placeholder="Unidad de medida" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.unidadMedida.invalid, 'is-valid': !f.unidadMedida.invalid }"
                                        [(ngModel)]="selectedUniMedida">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="tipoProduccion" class="col-lg-4 col-form-label pr-0">TIPO DE
                                    PRODUCCIÓN</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <ng-select [items]="listTipoProduccion" formControlName="tipoProduccion"
                                        class="form-control" bindLabel="Label" bindValue="Codigo"
                                        placeholder="Tipo de producción" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.tipoProduccion.invalid, 'is-valid': !f.tipoProduccion.invalid }"
                                        [(ngModel)]="selectedTipoProduccion">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="empaque" class="col-lg-4 col-form-label pr-0">EMPAQUE</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <ng-select [items]="listEmpaques" formControlName="empaque" class="form-control"
                                        bindLabel="Label" bindValue="Codigo" placeholder="Empaque"
                                        [(ngModel)]="selectedEmpaque" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.empaque.invalid, 'is-valid': !f.empaque.invalid }">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="tipoEmpaque" class="col-lg-5 col-form-label pr-0">TIPO EMPAQUE</label>
                                <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                    <ng-select [items]="listTiposEmpaques" formControlName="tipoEmpaque"
                                        class="form-control" bindLabel="Label" bindValue="Codigo"
                                        placeholder="Tipo Empaque" [(ngModel)]="selectedTipoEmpaque" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.tipoEmpaque.invalid, 'is-valid': !f.tipoEmpaque.invalid }">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="producto" class="col-lg-4 col-form-label">PRODUCTO</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <ng-select [items]="listProductos" formControlName="producto" class="form-control"
                                        bindLabel="Label" bindValue="Codigo" placeholder="Producto"
                                        [ngClass]="{ 'is-invalid': f.producto.invalid, 'is-valid': !f.producto.invalid }"
                                        [(ngModel)]="selectedProducto" (change)="ChangeProduct($event)"
                                        [readonly]="true">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="subProducto" class="col-lg-4 col-form-label">SUB PRODUCTO</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <ng-select [items]="listSubProductos" formControlName="subProducto"
                                        class="form-control" bindLabel="Label" bindValue="Codigo"
                                        placeholder="Sub Producto" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.subProducto.invalid, 'is-valid': !f.subProducto.invalid }"
                                        [(ngModel)]="selectedSubProducto">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="gradoPreparacion" class="col-lg-5 col-form-label">GRADO PREPARACIÓN</label>
                                <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                    <ng-select [items]="listGradosPreparacion" formControlName="gradoPreparacion"
                                        class="form-control" bindLabel="Label" bindValue="Codigo"
                                        placeholder="Grado Preparación" [(ngModel)]="selectedGradoPreparacion"
                                        [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.gradoPreparacion.invalid, 'is-valid': !f.gradoPreparacion.invalid }">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="calidad" class="col-lg-4 col-form-label">CALIDAD</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <ng-select [items]="listCalidad" formControlName="calidad" class="form-control"
                                        bindLabel="Label" bindValue="Codigo" placeholder="Calidad"
                                        [ngClass]="{ 'is-invalid': f.calidad.invalid, 'is-valid': !f.calidad.invalid }"
                                        [(ngModel)]="selectedCalidad" [readonly]="true">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="certificacion" class="col-lg-4 col-form-label">CERTIFICACIÓN</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <ng-select [items]="listCertificaciones" formControlName="certificacion"
                                        class="form-control" bindLabel="Label" bindValue="Codigo"
                                        placeholder="certificacion"
                                        [ngClass]="{ 'is-invalid': f.certificacion.invalid, 'is-valid': !f.certificacion.invalid }"
                                        [(ngModel)]="selectedCertificacion" [readonly]="true">
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="cantASolicitar" class="col-lg-5 col-form-label pr-0">CANTIDAD A
                                    SOLICITAR</label>
                                <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                    <input type="number" formControlName="cantASolicitar"
                                        class="form-control text-right" placeholder="Cantidad a solicitar"
                                        (blur)="CalcularPesoEnKilos()" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.cantASolicitar.invalid, 'is-valid': !f.cantASolicitar.invalid }">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="pesoXSaco" class="col-lg-4 col-form-label">PESO SACO (Kg.)</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <input type="number" formControlName="pesoXSaco" class="form-control text-right"
                                        placeholder="Peso por saco" (blur)="CalcularPesoEnKilos()" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.pesoXSaco.invalid, 'is-valid': !f.pesoXSaco.invalid }">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="pesoEnKilos" class="col-lg-4 col-form-label">PESO BRUTO (Kg.)</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <input type="number" formControlName="pesoEnKilos" class="form-control text-right"
                                        placeholder="Peso en kilos" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.pesoEnKilos.invalid, 'is-valid': !f.pesoEnKilos.invalid }">
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="form-row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="observaciones" class="col-lg-4 col-form-label">OBSERVACIONES</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <textarea class="form-control" formControlName="observaciones" rows="4"
                                        placeholder="Observaciones" maxlength="500" [readonly]="locCodigoEstadoInt >= 3"
                                        [ngClass]="{ 'is-invalid': f.observaciones.invalid, 'is-valid': !f.observaciones.invalid }"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"
                            *ngIf="locCodigoEstadoInt >= 4 && userSession.RolId != 6">
                            <div class="form-group row">
                                <label for="tara" class="col-lg-4 col-form-label">TARA (Kg.)</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <input type="number" formControlName="tara" class="form-control text-right"
                                        placeholder="Costo unitario" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.tara.invalid, 'is-valid': !f.tara.invalid }">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"
                            *ngIf="locCodigoEstadoInt >= 4 && userSession.RolId != 6">
                            <div class="form-group row">
                                <label for="kilosNetos" class="col-lg-4 col-form-label">PESO NETO (Kg.)</label>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                    <input type="number" formControlName="kilosNetos" class="form-control text-right"
                                        placeholder="Costo unitario" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.kilosNetos.invalid, 'is-valid': !f.kilosNetos.invalid }">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row" *ngIf="locId > 0">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="costoUnitario" class="col-lg-5 col-form-label">COSTO UNITARIO</label>
                                <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                    <input type="number" formControlName="costoUnitario" class="form-control text-right"
                                        placeholder="Costo unitario" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.costoUnitario.invalid, 'is-valid': !f.costoUnitario.invalid }">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <div class="form-group row">
                                <label for="costoTotal" class="col-lg-4 col-form-label">COSTO TOTAL</label>
                                <div class="col-lg-8">
                                    <input type="number" formControlName="costoTotal" class="form-control text-right"
                                        placeholder="Costo unitario" [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.costoTotal.invalid, 'is-valid': !f.costoTotal.invalid }">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row bg-primary align-middle mb-2 pt-1 pb-1"
                        *ngIf="userSession.RolId >= 7 && locCodigoEstadoInt >= 4">
                        <label class="text-white ml-1">SELECCIONAR AGRICULTORES</label>
                    </div>
                    <div class="form-row" *ngIf="userSession.RolId >= 7 && locCodigoEstadoInt >= 4">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <fieldset class="form-group">
                                <label>Mostrar
                                    <select name="users-list-select"
                                        class="form-control form-control-sm d-inline-block width-100 p-right-25 pl-4 mx-1"
                                        (click)="updateLimit($event)">
                                        <option value="10">10</option>
                                        <option value="25">25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                    Filas</label>
                                <button type="button" class="btn btn-sm float-right btn-primary"
                                    (click)="ActualizarListaAgricultores()">Actualizar Lista</button>
                            </fieldset>
                            <ngx-datatable class="bootstrap core-bootstrap" [columnMode]="'force'" [headerHeight]="50"
                                [footerHeight]="50" rowHeight="'auto'" [limit]="limitRef" [rows]="rows"
                                [scrollbarH]="true" [selected]="selectedAgricultores" [selectionType]="'checkbox'"
                                (select)="onSelectAgricultores($event)">
                                <ngx-datatable-column name="Nombre" prop="NombreCompleto">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Tipo Documento" prop="TipoDocumento">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Número Documento" prop="NumeroDocumento">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Celular" prop="NumeroTelefonoCelular">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Finca" prop="Finca">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Certificación" prop="TipoCertificacion">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Total Cosecha (Kg.)" prop="TotalCosecha"
                                    *ngIf="locCodigoEstadoInt === 4">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Cantidad Solicitada (Kg.)" prop="CantidadSolicitada"
                                    *ngIf="locCodigoEstadoInt >= 5 && locCodigoEstadoInt <= 8">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Fecha Actualización" prop="FechaActualizacionString"
                                    width="100" *ngIf="locCodigoEstadoInt === 4">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Usuario Registro" prop="UsuarioRegistro"
                                    *ngIf="locCodigoEstadoInt >= 5 && locCodigoEstadoInt <= 8">
                                </ngx-datatable-column>
                                <ngx-datatable-column name="Fecha Registro" prop="FechaRegistroString"
                                    *ngIf="locCodigoEstadoInt >= 5 && locCodigoEstadoInt <= 8">
                                </ngx-datatable-column>
                                <ngx-datatable-column name='' prop="selcheck" headerCheckboxable="true"
                                    checkboxable="true" width="30" sortable="false"
                                    *ngIf="userSession.RolId === 7 && locCodigoEstadoInt === 4">
                                </ngx-datatable-column>
                            </ngx-datatable>
                        </div>
                    </div>
                    <div class="form-row" *ngIf="locCodigoEstadoInt === 4">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <div class="form-group row">
                                <label
                                    class="col-lg-10 col-form-label text-danger font-weight-bolder">{{msgAgricultores}}</label>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-right">
                            <div class="form-group row">
                                <label for="sumaCosechaSeleccionada" class="col-lg-8 col-form-label">TOTAL (Kg.)</label>
                                <div class="col-lg-4">
                                    <input type="number" formControlName="sumaCosechaSeleccionada"
                                        class="form-control text-right" placeholder="Total de cosecha seleccionado"
                                        [readonly]="true"
                                        [ngClass]="{ 'is-invalid': f.sumaCosechaSeleccionada.invalid, 'is-valid': !f.sumaCosechaSeleccionada.invalid }">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="form-row"
        *ngIf="(userSession.RolId === 9 || userSession.RolId === 8 || userSession.RolId === 7) && (locCodigoEstadoInt === 7 || locCodigoEstadoInt === 8)">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="card">
                <div class="card-content">
                    <div class="card-body">
                        <ul ngbNav #nav="ngbNav" [activeId]="1" [destroyOnHide]="false"
                            class="nav-pills justify-content-left">
                            <li [ngbNavItem]="1" [destroyOnHide]="true">
                                <a ngbNavLink class="nav-link d-flex align-items-center">
                                    <span class="d-none d-sm-block" style="font-size: 1.1rem;">Control de Calidad</span>
                                </a>
                                <ng-template ngbNavContent>
                                    <div class="row" *ngFor="let item of detalleControlesCalidad">
                                        <div class="col-lg-3 col-md-2 col-sm-1 col-xs-0"></div>
                                        <div
                                            class="col-lg-6 col-md-8 col-sm-12 col-xs-12 mb-2 border border-primary rounded-lg">
                                            <div class="row mb-2 mt-1">
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                    <h4 class="text-center font-weight-bolder">ANÁLISIS FÍSICO</h4>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="form-group row">
                                                        <label for="observacionesAF"
                                                            class="col-lg-4 col-form-label font-weight-bold">AGRICULTOR:</label>
                                                        <div class="col-lg-8">
                                                            <label
                                                                class="col-form-label">{{item.NombreCompleto}}</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="form-group row">
                                                        <label for="porcHumedadAF"
                                                            class="col-lg-4 col-form-label font-weight-bold">%
                                                            HUMEDAD</label>
                                                        <div class="col-lg-8">
                                                            <input type="number" class="form-control form-control-sm"
                                                                placeholder="Porcentaje de humedad"
                                                                [readonly]="locCodigoEstadoInt === 8"
                                                                *ngIf="locCodigoEstadoInt === 7"
                                                                (blur)="changeValorCalidad($event, item.ContratoSocioFincaId, 'hmd')">
                                                            <input type="number" class="form-control form-control-sm"
                                                                placeholder="Porcentaje de humedad"
                                                                [readonly]="locCodigoEstadoInt === 8"
                                                                [value]="item.Humedad" *ngIf="locCodigoEstadoInt >= 8"
                                                                (blur)="changeValorCalidad($event, item.ContratoSocioFincaId, 'hmd')">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="form-group row">
                                                        <label for="observacionesAF"
                                                            class="col-lg-4 col-form-label font-weight-bold">OBSERVACIONES</label>
                                                        <div class="col-lg-8">
                                                            <textarea class="form-control form-control-sm"
                                                                id="observacionesAF" rows="2"
                                                                placeholder="Observaciones" maxlength="500"
                                                                [readonly]="locCodigoEstadoInt === 8"
                                                                *ngIf="locCodigoEstadoInt === 7"
                                                                (blur)="changeValorCalidad($event, item.ContratoSocioFincaId, 'obs')"></textarea>
                                                            <textarea class="form-control form-control-sm"
                                                                id="observacionesAF" rows="2"
                                                                placeholder="Observaciones" maxlength="500"
                                                                [readonly]="locCodigoEstadoInt === 8"
                                                                [value]="item.Observaciones"
                                                                *ngIf="locCodigoEstadoInt >= 8"
                                                                (blur)="changeValorCalidad($event, item.ContratoSocioFincaId, 'obs')"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <th class="text-center">OLOR</th>
                                                            <th class="text-center">SELECCIÓN</th>
                                                        </thead>
                                                        <tbody>
                                                            <tr *ngFor="let olor of listOlores">
                                                                <td>
                                                                    {{olor.Label}}
                                                                </td>
                                                                <td class="text-center">
                                                                    <input type="checkbox" [value]="olor.Codigo"
                                                                        *ngIf="locCodigoEstadoInt === 7"
                                                                        (change)="changeOlores($event, item.ContratoSocioFincaId)">
                                                                    <input type="checkbox" [value]="olor.Codigo"
                                                                        [disabled]="locCodigoEstadoInt === 8"
                                                                        [checked]="item.ListaOlores.includes(olor.Codigo)"
                                                                        *ngIf="locCodigoEstadoInt >= 8">
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <th class="text-center">COLOR</th>
                                                            <th class="text-center">SELECCIÓN</th>
                                                        </thead>
                                                        <tbody>
                                                            <tr *ngFor="let color of listColores">
                                                                <td>{{color.Label}}</td>
                                                                <td class="text-center">
                                                                    <input type="checkbox" [value]="color.Codigo"
                                                                        *ngIf="locCodigoEstadoInt === 7"
                                                                        (change)="changeColores($event, item.ContratoSocioFincaId)">
                                                                    <input type="checkbox" [value]="color.Codigo"
                                                                        [disabled]="locCodigoEstadoInt === 8"
                                                                        [checked]="item.ListaColores.includes(color.Codigo)"
                                                                        *ngIf="locCodigoEstadoInt >= 8">
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-2 col-sm-1 col-xs-0"></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-3 col-md-2 col-sm-1 col-xs-0"></div>
                                        <div class="col-lg-6 col-md-8 col-sm-12 col-xs-12">
                                            <div class="row">
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="form-group row">
                                                        <label for="observacionesAF"
                                                            class="col-lg-6 col-form-label font-weight-bold">RESPONSABLE
                                                            DEL CONTROL DE
                                                            CALIDAD</label>
                                                        <div class="col-lg-6">
                                                            <label
                                                                class="col-form-label">{{frmContratoCompraVenta.value.responsable}}</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-2 col-sm-1 col-xs-0"></div>
                                    </div>
                                </ng-template>
                            </li>
                            <li [ngbNavItem]="2" *ngIf="userSession.RolId === 8 && locCodigoEstadoInt === 8">
                                <a ngbNavLink class="nav-link d-flex align-items-center">
                                    <span class="d-none d-sm-block" style="font-size: 1.1rem;">Pesado del Café</span>
                                </a>
                                <ng-template ngbNavContent>
                                    <div class="row">
                                        <div class="col-lg-2 col-md-1"></div>
                                        <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12">
                                            <div class="row">
                                                <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                                                    <div class="row">
                                                        <div class="col-lg-12">
                                                            <h6 class="text-center">PESADO DEL CAFÉ</h6>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-12">
                                                            <div class="table-responsive">
                                                                <table class="table table-borderless table-sm">
                                                                    <tbody>
                                                                        <tr>
                                                                            <td>
                                                                                <h6>Sacos</h6>
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="sacosPC"
                                                                                    class="form-control form-control-sm text-right"
                                                                                    placeholder="Sacos"
                                                                                    [readonly]="true"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.sacosPC.invalid, 'is-valid': !submittedPesadoCafe && !f.sacosPC.invalid }">
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <h6>Peso Bruto (Kg.)</h6>
                                                                            </td>
                                                                            <td>
                                                                                <input type="number" [readonly]="true"
                                                                                    formControlName="kilosBrutosPC"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    placeholder="Kilos brutos"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.kilosBrutosPC.invalid, 'is-valid': !submittedPesadoCafe && !f.kilosBrutosPC.invalid }">
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <h6>Tara de Saco (Kg.)</h6>
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="taraSacoPC"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    placeholder="Tara de saco"
                                                                                    (blur)="CalcularPesadoCafe()"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.taraSacoPC.invalid, 'is-valid': !submittedPesadoCafe && !f.taraSacoPC.invalid }">
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <h6>Peso Neto (Kg.)</h6>
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="kilosNetosPC"
                                                                                    [readonly]="true"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    placeholder="Kilos netos"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.kilosNetosPC.invalid, 'is-valid': !submittedPesadoCafe && !f.kilosNetosPC.invalid }">
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <h6>QQ55,2/Kg</h6>
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="qq55KgPC"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    placeholder="QQ55,2/Kg"
                                                                                    [readonly]="true"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.qq55KgPC.invalid, 'is-valid': !submittedPesadoCafe && !f.qq55KgPC.invalid }">
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                                    <div class="row">
                                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                            <h6 class="text-center">ANÁLISIS FÍSICO DEL CAFÉ</h6>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                            <div class="table-responsive">
                                                                <table class="table table-borderless table-sm">
                                                                    <thead>
                                                                        <th class="text-center">Detalle</th>
                                                                        <th class="text-center">Gramos</th>
                                                                        <th class="text-center">%</th>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td>
                                                                                <h6>Café exportación</h6>
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="cafeExportacionGramos"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.cafeExportacionGramos.invalid, 'is-valid': !submittedPesadoCafe && !f.cafeExportacionGramos.invalid }"
                                                                                    (blur)="CalcularAnalisisFisico()">
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="cafeExportacionPorc"
                                                                                    [readonly]="true"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.cafeExportacionPorc.invalid, 'is-valid': !submittedPesadoCafe && !f.cafeExportacionPorc.invalid }">
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <h6>Descarte</h6>
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="descarteGramos"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.descarteGramos.invalid, 'is-valid': !submittedPesadoCafe && !f.descarteGramos.invalid }"
                                                                                    (blur)="CalcularAnalisisFisico()">
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="descartePorcentaje"
                                                                                    [readonly]="true"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.descartePorcentaje.invalid, 'is-valid': !submittedPesadoCafe && !f.descartePorcentaje.invalid }">
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <h6>Cáscara</h6>
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="cascaraGramos"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.cascaraGramos.invalid, 'is-valid': !submittedPesadoCafe && !f.cascaraGramos.invalid }"
                                                                                    (blur)="CalcularAnalisisFisico()">
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="cascaraPorcentaje"
                                                                                    [readonly]="true"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.cascaraPorcentaje.invalid, 'is-valid': !submittedPesadoCafe && !f.cascaraPorcentaje.invalid }">
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <h6>Total</h6>
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="totalGramos"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    [readonly]="true"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.totalGramos.invalid, 'is-valid': !submittedPesadoCafe && !f.totalGramos.invalid }">
                                                                            </td>
                                                                            <td>
                                                                                <input type="number"
                                                                                    formControlName="totalPorcentaje"
                                                                                    [readonly]="true"
                                                                                    class="form-control text-right form-control-sm"
                                                                                    [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.totalPorcentaje.invalid, 'is-valid': !submittedPesadoCafe && !f.totalPorcentaje.invalid }">
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                            <div class="form-group row">
                                                                <label for="humedadProcenPC"
                                                                    class="col-lg-4 col-form-label">HUMEDAD (%)</label>
                                                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                                                    <input type="number"
                                                                        formControlName="humedadProcenPC"
                                                                        class="form-control text-right form-control-sm"
                                                                        placeholder="Humedad %"
                                                                        [ngClass]="{ 'is-invalid': submittedPesadoCafe && f.humedadProcenPC.invalid, 'is-valid': !submittedPesadoCafe && !f.humedadProcenPC.invalid }">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="form-group row">
                                                        <label for="observacionesPC"
                                                            class="col-lg-4 col-form-label">OBSERVACIONES</label>
                                                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                                                            <textarea class="form-control form-control-sm"
                                                                formControlName="observacionesPC" rows="4"
                                                                placeholder="observacionesPC"
                                                                maxlength="500"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-2 col-md-1"></div>
                                    </div>
                                </ng-template>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div [ngbNavOutlet]="nav"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<div class="row" *ngIf="mostrarqr">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="card-content">
                <div class="text-center">
                    <qr-code [value]="codeqr" size="300" errorCorrectionLevel="M"></qr-code>
                </div>
            </div>
        </div>
    </div>
</div>
<ng-template #PrintTemplate>
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top: 20px;">
            <h3 class="text-center" style="font-weight: bold;">QR del Contrato
                {{this.frmContratoCompraVenta.value.correlativo}}</h3>
        </div>
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top: 50px;">
            <div class="text-center">
                <table style="margin: 5px auto;width: 850px;">
                    <tbody>
                        <tr>
                            <td class="text-left"> <label style="font-weight: bold;">Hash BlockChain: </label>
                                {{hashBC}}</td>
                            <td class="text-right"> <label style="font-weight: bold;">Fecha Hora: </label> {{fechaActual
                                | date:'dd/MM/yyyy HH:mm:ss'}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="text-center">
                <table style="margin: 5px auto">
                    <tbody>
                        <tr>
                            <td> <img [src]="urlCanvas" /></td>
                            <td> <img [src]="urlCanvas" /></td>
                            <td> <img [src]="urlCanvas" /></td>
                        </tr>
                        <tr>
                            <td> <img [src]="urlCanvas" /></td>
                            <td> <img [src]="urlCanvas" /></td>
                            <td> <img [src]="urlCanvas" /></td>
                        </tr>
                        <tr>
                            <td> <img [src]="urlCanvas" /></td>
                            <td> <img [src]="urlCanvas" /></td>
                            <td> <img [src]="urlCanvas" /></td>
                        </tr>
                        <tr>
                            <td> <img [src]="urlCanvas" /></td>
                            <td> <img [src]="urlCanvas" /></td>
                            <td> <img [src]="urlCanvas" /></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</ng-template>
<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="card-footer">
                <div class="form-row">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="form-group row m-0">
                            <div class="col-lg-12 text-right">
                                <button type="button" class="btn btn-primary mr-1" (click)="GenerarQRTrazabilidad()"
                                    *ngIf="(userSession.RolId === 6 || userSession.RolId === 7 || userSession.RolId === 8) && locCodigoEstadoInt === 11">Generar
                                    QR de
                                    Trazabilidad</button>
                                <button type="button" class="btn btn-secondary mr-1" (click)="onPrint()"
                                    *ngIf="(userSession.RolId === 6 || userSession.RolId === 7 || userSession.RolId === 8) && locCodigoEstadoInt === 11 && mostrarqr">
                                    Imprimir QR</button>
                                <button type="button" class="btn btn-primary mr-1" (click)="ConfirmarRecepcion()"
                                    *ngIf="userSession.RolId === 6 && locCodigoEstadoInt === 10">Confirmar
                                    Recepción del Producto</button>
                                <button type="button" class="btn btn-primary mr-1" (click)="Guardar()"
                                    *ngIf="(locCodigoEstadoInt === 4 &&  userSession.RolId === 7) || (locCodigoEstadoInt === 7 &&  userSession.RolId === 9)">Guardar</button>
                                <button type="button" class="btn btn-primary mr-1"
                                    *ngIf="locCodigoEstadoInt === 8 && userSession.RolId === 8"
                                    (click)="GenerarGuiaRecepcion()">Generar Guía de Recepción</button>
                                <button type="button" class="btn btn-primary mr-1" (click)="ConfirmarContrato()"
                                    *ngIf="locCodigoEstadoInt === 3 && userSession.RolId === 6">Confirmar
                                    Contrato</button>
                                <button type="button" class="btn btn-primary mr-1"
                                    *ngIf="locCodigoEstadoInt === 6 &&  userSession.RolId === 7"
                                    (click)="GenerarSolicitudTransporte()">Generar
                                    Solicitud de Transporte</button>
                                <button type="button" class="btn btn-danger" (click)="Cancelar()">Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="d-flex justify-content-between align-items-center">
    <ngx-spinner></ngx-spinner>
</div>